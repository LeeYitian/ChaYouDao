(self["webpackChunkfinal_vue"]=self["webpackChunkfinal_vue"]||[]).push([[516],{7317:function(e,t,a){a(7658),
/*!
  * Bootstrap selector-engine.js v5.2.1 (https://getbootstrap.com/)
  * Copyright 2011-2022 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */
function(t,l){e.exports=l(a(1437))}(0,(function(e){"use strict";const t={find(e,t=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(t,e))},findOne(e,t=document.documentElement){return Element.prototype.querySelector.call(t,e)},children(e,t){return[].concat(...e.children).filter((e=>e.matches(t)))},parents(e,t){const a=[];let l=e.parentNode.closest(t);while(l)a.push(l),l=l.parentNode.closest(t);return a},prev(e,t){let a=e.previousElementSibling;while(a){if(a.matches(t))return[a];a=a.previousElementSibling}return[]},next(e,t){let a=e.nextElementSibling;while(a){if(a.matches(t))return[a];a=a.nextElementSibling}return[]},focusableChildren(t){const a=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((e=>`${e}:not([tabindex^="-"])`)).join(",");return this.find(a,t).filter((t=>!e.isDisabled(t)&&e.isVisible(t)))}};return t}))},5469:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return me}});var l=a(3396),r=a(7139);const o={class:"container"},s={class:"table-responsive-lg"},n={class:"table table-hover text-primary mt-2 dashboard-table"},d=(0,l._)("thead",{class:"border-bottom border-primary border-2 bg-lightbrown"},[(0,l._)("tr",null,[(0,l._)("th",{width:"100",class:"text-center"},"建立時間"),(0,l._)("th",{width:"200",class:"text-center"},"訂單內容"),(0,l._)("th",{width:"120",class:"text-center"},"附註"),(0,l._)("th",{width:"100",class:"text-center"},"總額"),(0,l._)("th",{width:"100",class:"text-center"},"付款"),(0,l._)("th",{width:"120",class:"text-center"},"編輯")])],-1),i={class:"text-end"},c={key:0,class:"text-success"},u={key:1,class:"text-danger"},p={class:"text-center"},m={class:"btn-group"},h=["onClick"],_=["onClick"];function b(e,t,a,b,f,g){const y=(0,l.up)("PaginationBar"),v=(0,l.up)("UpdateOrderModal"),w=(0,l.up)("DeleteModal");return(0,l.wg)(),(0,l.iD)(l.HY,null,[(0,l._)("div",o,[(0,l._)("div",s,[(0,l._)("table",n,[d,(0,l._)("tbody",null,[((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(f.orders,(t=>((0,l.wg)(),(0,l.iD)("tr",{key:t.id,class:"align-middle"},[(0,l._)("td",null,(0,r.zw)(e.$filters.date(t.create_at)),1),(0,l._)("td",null,(0,r.zw)(g.orderContent(t.products)),1),(0,l._)("td",null,(0,r.zw)(t.message),1),(0,l._)("td",i,(0,r.zw)(t.total),1),(0,l._)("td",null,[t.is_paid?((0,l.wg)(),(0,l.iD)("span",c,"付款")):((0,l.wg)(),(0,l.iD)("span",u,"未付款"))]),(0,l._)("td",p,[(0,l._)("div",m,[(0,l._)("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:e=>g.adjustOrder(t)}," 修改 ",8,h),(0,l._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:e=>g.deleteOrder(t)}," 刪除 ",8,_)])])])))),128))])])]),(0,l._)("button",{class:"btn btn-danger mt-2 btn-sm d-block ms-auto",type:"button",onClick:t[0]||(t[0]=e=>g.deleteOrder({title:"全部訂單"}))}," 刪除所有訂單 ")]),(0,l.Wm)(y,(0,r.vs)((0,l.F4)(f.pagination)),null,16),(0,l.Wm)(v,{"temp-info":f.tempOrder,onUpdateOrder:g.update,ref:"updateOrder"},null,8,["temp-info","onUpdateOrder"]),(0,l.Wm)(w,{"temp-info":f.tempOrder,onDeleteInfo:g.erase,ref:"deleteOrder"},null,8,["temp-info","onDeleteInfo"])],64)}a(7658);var f=a(9242);const g={class:"modal fade modal-xl",id:"UpdateOrderModal",tabindex:"-1",ref:"myModal"},y={class:"modal-dialog modal-dialog-scrollable"},v={class:"modal-content border-0"},w={class:"modal-header bg-primary text-white"},x=(0,l._)("h5",{class:"modal-title"},[(0,l._)("span",null,"修改訂單")],-1),D={class:"modal-body"},k={class:"row"},O={class:"col-lg-5"},$=(0,l._)("h5",null,"訂單資訊",-1),C={class:"mb-3"},M=(0,l._)("label",{class:"form-label",for:"orderDate"},"訂單成立日期",-1),U={class:"mb-3"},V=(0,l._)("label",{class:"form-label",for:"orderContent"},"訂單內容",-1),E=["onClick"],S={class:"input-group-text flex-column"},j={key:0},q=["onUpdate:modelValue"],z={class:"mb-3"},N=(0,l._)("label",{class:"form-label",for:"orderTotal"},"總金額",-1),I={class:"mb-3"},T=(0,l._)("label",{class:"form-label",for:"orderDescription"},"附註",-1),Y={class:"col-lg-7"},Z=(0,l._)("h5",null,"客戶資訊",-1),A={class:"row"},H={class:"col-6"},P={class:"mb-3"},W=(0,l._)("label",{class:"form-label",for:"orderName"},"姓名",-1),F={class:"mb-3"},K=(0,l._)("label",{class:"form-label",for:"orderEmail"},"信箱",-1),B={class:"mb-3"},G=(0,l._)("label",{class:"form-label",for:"orderPaidDate"},"付款日期",-1),J={class:"col-6"},L={class:"mb-3"},Q=(0,l._)("label",{class:"form-label",for:"orderTel"},"電話",-1),R={class:"mb-3"},X=(0,l._)("label",{class:"form-label",for:"orderAddress"},"地址",-1),ee={class:"mb-3"},te={class:"form-check"},ae=(0,l._)("label",{class:"form-check-label",for:"is_paid"}," 付款／未付款 ",-1),le={class:"modal-footer"};function re(e,t,a,o,s,n){return(0,l.wg)(),(0,l.iD)("div",g,[(0,l._)("div",y,[(0,l._)("div",v,[(0,l._)("div",w,[x,(0,l._)("button",{type:"button",class:"btn-close btn-close-white",onClick:t[0]||(t[0]=e=>this.hideModal())})]),(0,l._)("div",D,[(0,l._)("div",k,[(0,l._)("div",O,[$,(0,l._)("div",C,[M,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.create_at=e),class:"form-control",id:"orderDate",type:"date",readonly:""},null,512),[[f.nr,s.create_at]])]),(0,l._)("div",U,[V,((0,l.wg)(!0),(0,l.iD)(l.HY,null,(0,l.Ko)(s.products,(e=>((0,l.wg)(),(0,l.iD)("div",{key:e.id,class:"input-group"},[(0,l._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:t=>n.remove(e.id)}," 刪除 ",8,E),(0,l._)("div",S,[(0,l._)("span",null,(0,r.zw)(e.product.title),1),e.coupon?((0,l.wg)(),(0,l.iD)("small",j,"coupon："+(0,r.zw)(e.coupon.code),1)):(0,l.kq)("",!0)]),(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t=>e.qty=t,class:"form-control",type:"number",min:"0"},null,8,q),[[f.nr,e.qty]])])))),128))]),(0,l._)("div",z,[N,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>s.order.total=e),class:"form-control",id:"orderTotal",min:"0",type:"number",readonly:""},null,512),[[f.nr,s.order.total]])]),(0,l._)("div",I,[T,(0,l.wy)((0,l._)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=e=>s.order.message=e),class:"form-control",id:"orderDescription"},null,512),[[f.nr,s.order.message]])])]),(0,l._)("div",Y,[Z,(0,l._)("div",A,[(0,l._)("div",H,[(0,l._)("div",P,[W,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>s.user.name=e),class:"form-control",type:"text",id:"orderName"},null,512),[[f.nr,s.user.name]])]),(0,l._)("div",F,[K,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>s.user.email=e),class:"form-control",type:"email",id:"orderEmail"},null,512),[[f.nr,s.user.email]])]),(0,l._)("div",B,[G,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>s.paid_date=e),class:"form-control",type:"date",id:"orderPaidDate"},null,512),[[f.nr,s.paid_date]])])]),(0,l._)("div",J,[(0,l._)("div",L,[Q,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>s.user.tel=e),class:"form-control",type:"tel",id:"orderTel"},null,512),[[f.nr,s.user.tel]])]),(0,l._)("div",R,[X,(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t[8]||(t[8]=e=>s.user.address=e),class:"form-control",type:"text",id:"orderAddress"},null,512),[[f.nr,s.user.address]])])])]),(0,l._)("div",ee,[(0,l._)("div",te,[(0,l.wy)((0,l._)("input",{"onUpdate:modelValue":t[9]||(t[9]=e=>s.order.is_paid=e),class:"form-check-input",type:"checkbox",id:"is_paid",onChange:t[10]||(t[10]=(...e)=>n.paymentStatus&&n.paymentStatus(...e))},null,544),[[f.e8,s.order.is_paid]]),ae])])])])]),(0,l._)("div",le,[(0,l._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:t[11]||(t[11]=e=>this.hideModal())}," 取消 "),(0,l._)("button",{type:"button",class:"btn btn-primary",onClick:t[12]||(t[12]=(...e)=>n.emit&&n.emit(...e))}," 確認 ")])])])],512)}var oe=a(1339),se={mixins:[oe.Z],props:["tempInfo"],data(){return{create_at:"",products:{},user:{},paid_date:"",order:{}}},watch:{tempInfo(e,t){this.changeDate(e.create_at,"create_at"),this.changeDate(e.paid_date,"paid_date"),this.products={...e.products},this.user={...e.user},this.order={...e}},products:{handler(e,t){if(0!==Object.keys(t).length){this.order.total=0;for(const t in e){if(e[t].qty<0)return void alert("數量不得為負數");e[t].total=e[t].product.price*e[t].qty,e[t].coupon?e[t].final_total=Math.round(e[t].total*(.01*e[t].coupon.percent)):e[t].final_total=e[t].total,this.order.total+=e[t].final_total}}},deep:!0}},methods:{changeDate(e,t){if(!e)return void(this[t]="");const a=new Date(1e3*e),l=a.getFullYear(),r=("0"+(a.getMonth()+1)).slice(-2),o=("0"+a.getDate()).slice(-2);this[t]=`${l}-${r}-${o}`},paymentStatus(){this.order.is_paid?this.order.paid_date?this.changeDate(this.order.paid_date,"paid_date"):this.changeDate(Date.now()/1e3,"paid_date"):this.paid_date=""},remove(e){delete this.products[e],0===Object.keys(this.products).length&&(this.order.total=0)},emit(){const e=new Date(this.paid_date)/1e3,t={...this.order,paid_date:e,products:{...this.products},user:{...this.user}};this.$emit("updateOrder",t),this.hideModal()}}},ne=a(89);const de=(0,ne.Z)(se,[["render",re]]);var ie=de,ce=a(8660),ue={emits:["loading"],inject:["emitter"],data(){return{orders:[],pagination:{},tempOrder:{},isNew:!1}},components:{UpdateOrderModal:ie,DeleteModal:ce.Z},methods:{getOrders(e=1){this.$emit("loading",!0);const t=`https://vue3-course-api.hexschool.io/api/lyt-api/admin/orders?page=${e}`;this.$http.get(t).then((e=>{const{orders:t,pagination:a}=e.data;this.orders=t,this.pagination=a;const l={...e.data,event:"取得訂單列表"};this.emitter.emit("toastMsg",l),this.$emit("loading",!1)})).catch((e=>console.log(e)))},orderContent(e){const t=[];for(const a in e)t.push(e[a].product.title);return t.join("、")},adjustOrder(e){this.tempOrder=e,this.$refs.updateOrder.showModal()},deleteOrder(e){this.tempOrder=e,this.$refs.deleteOrder.showModal()},update(e){this.$emit("loading",!0);const t=`https://vue3-course-api.hexschool.io/api/lyt-api/admin/order/${e.id}`,a={data:{...e}};this.$http.put(t,a).then((e=>{const t={...e.data,event:"更新訂單"};this.emitter.emit("toastMsg",t),this.getOrders()})).catch((e=>console.log(e)))},erase(e){this.$emit("loading",!0);let t="";t=e.title?"https://vue3-course-api.hexschool.io/api/lyt-api/admin/orders/all":`https://vue3-course-api.hexschool.io/api/lyt-api/admin/order/${e.id}`,this.$http.delete(t).then((e=>{const t={...e.data,event:"刪除訂單"};this.emitter.emit("toastMsg",t),this.getOrders()})).catch((e=>console.log(e)))}},created(){this.getOrders()}};const pe=(0,ne.Z)(ue,[["render",b]]);var me=pe}}]);
//# sourceMappingURL=516.fd30a151.js.map