(self["webpackChunkfinal_vue"]=self["webpackChunkfinal_vue"]||[]).push([[520],{7317:function(t,e,o){o(7658),
/*!
  * Bootstrap selector-engine.js v5.2.1 (https://getbootstrap.com/)
  * Copyright 2011-2022 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */
function(e,n){t.exports=n(o(1437))}(0,(function(t){"use strict";const e={find(t,e=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(e,t))},findOne(t,e=document.documentElement){return Element.prototype.querySelector.call(e,t)},children(t,e){return[].concat(...t.children).filter((t=>t.matches(e)))},parents(t,e){const o=[];let n=t.parentNode.closest(e);while(n)o.push(n),n=n.parentNode.closest(e);return o},prev(t,e){let o=t.previousElementSibling;while(o){if(o.matches(e))return[o];o=o.previousElementSibling}return[]},next(t,e){let o=t.nextElementSibling;while(o){if(o.matches(e))return[o];o=o.nextElementSibling}return[]},focusableChildren(e){const o=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((t=>`${t}:not([tabindex^="-"])`)).join(",");return this.find(o,e).filter((e=>!t.isDisabled(e)&&t.isVisible(e)))}};return e}))},9851:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return G}});var n=o(3396),a=o(7139);const s={class:"container"},l={class:"table-responsive-lg"},i={class:"table table-hover text-primary mt-2 dashboard-table"},c=(0,n._)("thead",{class:"border-bottom border-light border-2 text-bg-darkgreen"},[(0,n._)("tr",null,[(0,n._)("th",{width:"120",class:"text-center"},"名稱"),(0,n._)("th",{width:"120",class:"text-center"},"優惠"),(0,n._)("th",{width:"120",class:"text-center"},"到期日"),(0,n._)("th",{width:"120",class:"text-center"},"啟用"),(0,n._)("th",{width:"120",class:"text-center"},"編輯")])],-1),u={class:"text-end"},d={key:0,class:"text-success"},r={key:1,class:"text-muted"},p={class:"text-center"},m={class:"btn-group"},h=["onClick"],b=["onClick"];function _(t,e,o,_,f,g){const v=(0,n.up)("PaginationBar"),w=(0,n.up)("UpdateCouponModal"),C=(0,n.up)("DeleteModal");return(0,n.wg)(),(0,n.iD)(n.HY,null,[(0,n._)("div",s,[(0,n._)("button",{class:"btn btn-darkgreen mt-2 btn-sm d-block ms-auto",type:"button",onClick:e[0]||(e[0]=t=>g.adjustCoupon({},t))}," 新增優惠券 "),(0,n._)("div",l,[(0,n._)("table",i,[c,(0,n._)("tbody",null,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(f.coupons,(e=>((0,n.wg)(),(0,n.iD)("tr",{key:e.id,class:"align-middle"},[(0,n._)("td",null,(0,a.zw)(e.title),1),(0,n._)("td",u,(0,a.zw)(`${e.percent} %`),1),(0,n._)("td",null,(0,a.zw)(t.$filters.date(e.due_date)),1),(0,n._)("td",null,[e.is_enabled?((0,n.wg)(),(0,n.iD)("span",d,"啟用")):((0,n.wg)(),(0,n.iD)("span",r,"未啟用"))]),(0,n._)("td",p,[(0,n._)("div",m,[(0,n._)("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:t=>g.adjustCoupon(e,t)}," 編輯 ",8,h),(0,n._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:t=>g.deleteCoupon(e)}," 刪除 ",8,b)])])])))),128))])])])]),(0,n.Wm)(v,(0,a.vs)((0,n.F4)(f.pagination)),null,16),(0,n.Wm)(w,{"temp-info":f.tempCoupon,onUpdateCoupon:g.update,ref:"updateCoupon"},null,8,["temp-info","onUpdateCoupon"]),(0,n.Wm)(C,{"temp-info":f.tempCoupon,onDeleteInfo:g.erase,ref:"deleteCoupon"},null,8,["temp-info","onDeleteInfo"])],64)}var f=o(9242);const g={class:"modal fade updateCoupon",id:"UpdateCouponModal",tabindex:"-1",ref:"myModal"},v={class:"modal-dialog modal-dialog-scrollable"},w={class:"modal-content border-0"},C=(0,n._)("div",{class:"modal-header bg-darkgreen text-white"},[(0,n._)("h5",{class:"modal-title"},[(0,n._)("span",null,"新增／修改優惠券")]),(0,n._)("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal"})],-1),y={class:"modal-body"},x={class:"row"},k={class:"mb-3"},$=(0,n._)("label",{class:"form-label",for:"couponTitle"},"優惠券名稱",-1),D={class:"mb-3"},M=(0,n._)("label",{class:"form-label",for:"couponCode"},"代碼",-1),U={class:"mb-3"},E=(0,n._)("label",{class:"form-label",for:"couponPercent"},"折數",-1),N={class:"input-group input-group-sm"},S=(0,n._)("span",{class:"input-group-text"},"%",-1),V={class:"mb-3"},j=(0,n._)("label",{class:"form-label",for:"couponDate"},"到期日",-1),I={class:"mb-3"},Z={class:"form-check"},z=(0,n._)("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),P={class:"modal-footer"},T=(0,n._)("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function W(t,e,o,a,s,l){return(0,n.wg)(),(0,n.iD)("div",g,[(0,n._)("div",v,[(0,n._)("div",w,[C,(0,n._)("div",y,[(0,n._)("div",x,[(0,n._)("div",k,[$,(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>s.coupon.title=t),class:"form-control form-control-sm",type:"text",id:"couponTitle"},null,512),[[f.nr,s.coupon.title]])]),(0,n._)("div",D,[M,(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.coupon.code=t),class:"form-control form-control-sm",type:"text",id:"couponCode"},null,512),[[f.nr,s.coupon.code]])]),(0,n._)("div",U,[E,(0,n._)("div",N,[(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.coupon.percent=t),class:"form-control",type:"number",min:"0",max:"100",id:"couponPercent"},null,512),[[f.nr,s.coupon.percent]]),S])]),(0,n._)("div",V,[j,(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.coupon.due_date=t),class:"form-control form-control-sm",type:"date",id:"couponDate"},null,512),[[f.nr,s.coupon.due_date]])]),(0,n._)("div",I,[(0,n._)("div",Z,[(0,n.wy)((0,n._)("input",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.coupon.is_enabled=t),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled"},null,512),[[f.e8,s.coupon.is_enabled]]),z])])])]),(0,n._)("div",P,[T,(0,n._)("button",{type:"button",class:"btn btn-darkgreen",onClick:e[5]||(e[5]=(...t)=>l.emit&&l.emit(...t))}," 確認 ")])])])],512)}var Y=o(1339),q={mixins:[Y.Z],props:["tempInfo"],data(){return{coupon:{}}},watch:{tempInfo(t,e){if(this.coupon={...t},this.coupon.due_date){const t=new Date(1e3*this.coupon.due_date),e=t.getFullYear(),o=("0"+(t.getMonth()+1)).slice(-2),n=("0"+t.getDate()).slice(-2);this.coupon.due_date=`${e}-${o}-${n}`}}},methods:{emit(){const t=Math.floor(Date.now()/1e3),e=Math.floor(new Date(this.coupon.due_date)/1e3);if(t>e)return void alert("截止日期不得早於今日");if(this.coupon.percent<0)return void alert("折數不得為負數");this.coupon.due_date=e;const o={...this.coupon};this.$emit("updateCoupon",o),this.hideModal()}}},F=o(89);const H=(0,F.Z)(q,[["render",W]]);var A=H,B=o(8660),K={inject:["emitter"],emits:["loading"],data(){return{coupons:[],pagination:{},tempCoupon:{},isNew:!1}},components:{UpdateCouponModal:A,DeleteModal:B.Z},methods:{getCoupon(t=1){this.$emit("loading",!0);const e=`https://vue3-course-api.hexschool.io/api/lyt-api/admin/coupons?page=${t}`;this.$http.get(e).then((t=>{this.$emit("loading",!1);const{coupons:e,pagination:o}=t.data;this.coupons=e,this.pagination=o;const n={...t.data,event:"取得優惠券列表"};this.emitter.emit("toastMsg",n)})).catch((t=>console.log(t)))},adjustCoupon(t,e){"編輯"===e.currentTarget.textContent.trim()?this.isNew=!1:this.isNew=!0,this.tempCoupon=t,this.$refs.updateCoupon.showModal()},deleteCoupon(t){this.tempCoupon=t,this.$refs.deleteCoupon.showModal()},update(t){this.$emit("loading",!0);let e="",o="",n={};switch(this.isNew){case!0:e="https://vue3-course-api.hexschool.io/api/lyt-api/admin/coupon",o="post",n={data:{...t}};break;case!1:e=`https://vue3-course-api.hexschool.io/api/lyt-api/admin/coupon/${t.id}`,o="put",n={data:{...t}};break}this.$http({url:e,method:o,data:n}).then((t=>{const e={...t.data,event:"新增／更新優惠券"};this.emitter.emit("toastMsg",e),this.getCoupon()})).catch((t=>console.log(t)))},erase(t){this.$emit("loading",!0);const e=`https://vue3-course-api.hexschool.io/api/lyt-api/admin/coupon/${t.id}`;this.$http.delete(e).then((t=>{const e={...t.data,event:"刪除優惠券"};this.emitter.emit("toastMsg",e),this.getCoupon()})).catch((t=>console.log(t)))}},created(){this.getCoupon()}};const O=(0,F.Z)(K,[["render",_]]);var G=O}}]);
//# sourceMappingURL=520.9599198e.js.map