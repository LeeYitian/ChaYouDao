"use strict";(self["webpackChunkfinal_vue"]=self["webpackChunkfinal_vue"]||[]).push([[792],{8792:function(t,e,l){l.r(e),l.d(e,{default:function(){return wt}});var i=l(3396),o=l(7139);const r={class:"container"},s={class:"table-responsive-lg"},a={class:"table table-hover text-primary mt-2 dashboard-table"},n=(0,i._)("thead",{class:"border-bottom border-primary border-2 bg-lightbrown"},[(0,i._)("tr",null,[(0,i._)("th",{width:"120",class:"text-center"},"分類"),(0,i._)("th",{width:"200",class:"text-center"},"產品名稱"),(0,i._)("th",{width:"120",class:"text-center"},"原價"),(0,i._)("th",{width:"120",class:"text-center"},"售價"),(0,i._)("th",{width:"100",class:"text-center"},"啟用"),(0,i._)("th",{width:"120",class:"text-center"},"編輯")])],-1),c={class:"text-end"},m={class:"text-end"},d={key:0,class:"text-success"},p={key:1,class:"text-muted"},u={class:"text-center"},g={class:"btn-group"},h=["onClick"],b=["onClick"];function f(t,e,l,f,_,U){const v=(0,i.up)("PaginationBar"),I=(0,i.up)("UpdateProductModal"),y=(0,i.up)("DeleteModal");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",r,[(0,i._)("button",{class:"btn btn-primary mt-2 btn-sm d-block ms-auto",onClick:e[0]||(e[0]=t=>U.adjustProduct({},t)),type:"button"}," 建立新產品 "),(0,i._)("div",s,[(0,i._)("table",a,[n,(0,i._)("tbody",null,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(_.products,(e=>((0,i.wg)(),(0,i.iD)("tr",{key:e.id,class:"align-middle"},[(0,i._)("td",null,(0,o.zw)(e.category),1),(0,i._)("td",null,(0,o.zw)(e.title),1),(0,i._)("td",c,(0,o.zw)(t.$filters.currency(e.origin_price)),1),(0,i._)("td",m,(0,o.zw)(t.$filters.currency(e.price)),1),(0,i._)("td",null,[e.is_enabled?((0,i.wg)(),(0,i.iD)("span",d,"啟用")):((0,i.wg)(),(0,i.iD)("span",p,"未啟用"))]),(0,i._)("td",u,[(0,i._)("div",g,[(0,i._)("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:t=>U.adjustProduct(e,t)}," 編輯 ",8,h),(0,i._)("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:t=>U.deleteProduct(e)}," 刪除 ",8,b)])])])))),128))])])])]),(0,i.Wm)(v,(0,i.dG)(_.pagination,{onPage:U.getProducts}),null,16,["onPage"]),(0,i.Wm)(I,{"temp-info":_.tempProduct,onUpdateProduct:U.update,ref:"updateProductModal"},null,8,["temp-info","onUpdateProduct"]),(0,i.Wm)(y,{"temp-info":_.tempProduct,onDeleteInfo:U.erase,ref:"deleteModal"},null,8,["temp-info","onDeleteInfo"])],64)}var _=l(9242);const U={class:"modal fade modal-xl",id:"productModal",tabindex:"-1",ref:"myModal"},v={class:"modal-dialog modal-dialog-scrollable"},I={class:"modal-content border-0"},y={class:"modal-header bg-primary text-white"},w=(0,i._)("h5",{class:"modal-title"},[(0,i._)("span",null,"新增／修改產品")],-1),L={class:"modal-body"},x={class:"row"},k={class:"col-lg-5"},P={class:"mb-3"},M=(0,i._)("label",{for:"image",class:"form-label"},"上傳主要圖片",-1),$={class:"mb-3"},C=(0,i._)("label",{for:"customFile",class:"form-label"},"或 從電腦上傳 ",-1),F={class:"position-relative img-pre"},T=["src"],D=(0,i._)("label",{for:"imageSec",class:"form-label"},"上傳次要圖片",-1),N={class:"mb-2 input-group input-group-sm",ref:"minorInputUrl"},A=(0,i._)("button",{type:"button",class:"btn btn-outline-danger"}," 移除 ",-1),S={class:"mb-3",ref:"minoreInputLocal"},E=(0,i._)("label",{for:"customFileSec",class:"form-label"},"或 從電腦上傳 ",-1),O={class:"row g-1 mb-3"},V={class:"position-relative img-pre"},j=["src"],R=(0,i._)("i",{class:"position-absolute top-0 start-100 translate-middle bi bi-x-circle"},null,-1),B=["disabled"],q={class:"col-lg-7"},z={class:"mb-3"},Z=(0,i._)("label",{for:"title",class:"form-label"},"標題",-1),H={class:"row gx-2"},W={class:"mb-3 col-md-6"},Y=(0,i._)("label",{for:"category",class:"form-label"},"分類",-1),K={class:"mb-3 col-md-6"},G=(0,i._)("label",{for:"price",class:"form-label"},"單位",-1),J={class:"row gx-2"},Q={class:"mb-3 col-md-6"},X=(0,i._)("label",{for:"origin_price",class:"form-label"},"原價",-1),tt={class:"mb-3 col-md-6"},et=(0,i._)("label",{for:"price",class:"form-label"},"售價",-1),lt=(0,i._)("hr",null,null,-1),it={class:"mb-3"},ot=(0,i._)("label",{for:"description",class:"form-label"},"產品描述",-1),rt={class:"mb-3"},st=(0,i._)("label",{for:"content",class:"form-label"},"說明內容",-1),at={class:"mb-3"},nt={class:"form-check"},ct=(0,i._)("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),mt={class:"modal-footer"},dt=["disabled"];function pt(t,e,l,o,r,s){return(0,i.wg)(),(0,i.iD)("div",U,[(0,i._)("div",v,[(0,i._)("div",I,[(0,i._)("div",y,[w,(0,i._)("button",{type:"button",class:"btn-close btn-close-white",onClick:e[0]||(e[0]=(...t)=>s.dismiss&&s.dismiss(...t))})]),(0,i._)("div",L,[(0,i._)("div",x,[(0,i._)("div",k,[(0,i._)("div",P,[M,(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>r.temp.mainImgUrl=t),type:"url",class:"form-control",id:"image",placeholder:"請輸入主要圖片連結"},null,512),[[_.nr,r.temp.mainImgUrl]])]),(0,i._)("div",$,[C,(0,i._)("input",{type:"file",id:"customFile",class:"form-control",name:"file-to-upload",onChange:e[2]||(e[2]=(...t)=>s.createImgUrl&&s.createImgUrl(...t)),ref:"inputMain"},null,544)]),(0,i.wy)((0,i._)("div",F,[(0,i._)("img",{class:"img-fluid",id:"preview",src:r.temp.mainImgUrl||r.temp.mainImgLocal,alt:"產品圖片"},null,8,T),(0,i._)("i",{onClick:e[3]||(e[3]=(0,_.iM)(((...t)=>s.removeUpload&&s.removeUpload(...t)),["stop"])),class:"position-absolute top-0 start-100 translate-middle bi bi-x-circle","data-fun":"url"})],512),[[_.F8,r.temp.mainImgUrl||r.temp.mainImgLocal]]),(0,i._)("div",{class:"mt-5",ref:"minorInputs","data-fun":"urls",onClick:e[6]||(e[6]=(0,_.iM)(((...t)=>s.removeUpload&&s.removeUpload(...t)),["stop"]))},[D,(0,i._)("div",N,[(0,i._)("input",{type:"url",id:"imageSec",class:"form-control minorInputUrl",placeholder:"請輸入次要圖片連結",onChange:e[4]||(e[4]=(...t)=>s.minorImgUrlUpload&&s.minorImgUrlUpload(...t))},null,32),A],512),(0,i._)("div",S,[E,(0,i._)("input",{type:"file",id:"customFileSec",class:"form-control",name:"files-to-upload",multiple:"",onChange:e[5]||(e[5]=(...t)=>s.createMinorImgUrl&&s.createMinorImgUrl(...t)),ref:"inputMinor"},null,544)],512),(0,i.wy)((0,i._)("div",O,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(s.minorImgAll,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t,class:"col-3"},[(0,i._)("div",V,[(0,i._)("img",{class:"img-fluid",id:"previews",src:t,alt:"產品圖片"},null,8,j),R])])))),128))],512),[[_.F8,s.minorImgAll!==[]]])],512),(0,i._)("div",null,[(0,i._)("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:e[7]||(e[7]=(...t)=>s.uploadAllImg&&s.uploadAllImg(...t)),disabled:r.imgUploading}," 上傳圖片 ",8,B)])]),(0,i._)("div",q,[(0,i._)("div",z,[Z,(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":e[8]||(e[8]=t=>r.product.title=t),type:"text",class:"form-control",id:"title",placeholder:"請輸入標題"},null,512),[[_.nr,r.product.title]])]),(0,i._)("div",H,[(0,i._)("div",W,[Y,(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":e[9]||(e[9]=t=>r.product.category=t),type:"text",class:"form-control",id:"category",placeholder:"請輸入分類"},null,512),[[_.nr,r.product.category]])]),(0,i._)("div",K,[G,(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":e[10]||(e[10]=t=>r.product.unit=t),type:"text",class:"form-control",id:"unit",placeholder:"請輸入單位"},null,512),[[_.nr,r.product.unit]])])]),(0,i._)("div",J,[(0,i._)("div",Q,[X,(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":e[11]||(e[11]=t=>r.product.origin_price=t),type:"number",class:"form-control",min:"0",id:"origin_price",placeholder:"請輸入原價"},null,512),[[_.nr,r.product.origin_price]])]),(0,i._)("div",tt,[et,(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":e[12]||(e[12]=t=>r.product.price=t),type:"number",class:"form-control",min:"0",id:"price",placeholder:"請輸入售價"},null,512),[[_.nr,r.product.price]])])]),lt,(0,i._)("div",it,[ot,(0,i.wy)((0,i._)("textarea",{"onUpdate:modelValue":e[13]||(e[13]=t=>r.product.description=t),type:"text",class:"form-control",id:"description",placeholder:"請輸入產品描述"},null,512),[[_.nr,r.product.description]])]),(0,i._)("div",rt,[st,(0,i.wy)((0,i._)("textarea",{"onUpdate:modelValue":e[14]||(e[14]=t=>r.product.content=t),type:"text",class:"form-control",id:"content",placeholder:"請輸入產品說明內容"},null,512),[[_.nr,r.product.content]])]),(0,i._)("div",at,[(0,i._)("div",nt,[(0,i.wy)((0,i._)("input",{"onUpdate:modelValue":e[15]||(e[15]=t=>r.product.is_enabled=t),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled"},null,512),[[_.e8,r.product.is_enabled]]),ct])])])])]),(0,i._)("div",mt,[(0,i._)("button",{type:"button",class:"btn btn-outline-secondary",onClick:e[16]||(e[16]=(...t)=>s.dismiss&&s.dismiss(...t))}," 取消 "),(0,i._)("button",{type:"button","data-bs-toggle":"tooltip","data-bs-title":"請記得點選上傳圖片",class:"btn btn-primary",onClick:e[17]||(e[17]=(...t)=>s.emit&&s.emit(...t)),disabled:r.imgUploading}," 確認 ",8,dt)])])])],512)}l(7658);var ut=l(1339),gt=l(2649),ht=l.n(gt),bt={mixins:[ut.Z],props:["tempInfo"],data(){return{key:0,imgUploading:!1,temp:{mainImgUrl:"",mainImgLocal:"",minorImgUrls:[],minorFileList:[],minorImgLocals:[]},product:{}}},computed:{minorImgAll(){return[...this.temp.minorImgUrls,...this.temp.minorImgLocals]}},watch:{tempInfo(t,e){this.product={...t},this.temp={mainImgUrl:"",mainImgLocal:"",minorImgUrls:[],minorFileList:[],minorImgLocals:[]},this.product.imagesUrl&&(this.temp.minorImgUrls=[...this.product.imagesUrl]),this.temp.mainImgUrl=this.product.imageUrl||""}},methods:{dismiss(){this.temp={mainImgUrl:"",mainImgLocal:"",minorImgUrls:[],minorFileList:[],minorImgLocals:[]};const t=document.querySelectorAll(".minorInputUrl");t.forEach((t=>{""!==t.value&&t.parentNode.remove()})),this.hideModal()},createImgUrl(t){if(""!==this.temp.mainImgUrl)return alert("請先移除上方網址"),void(t.currentTarget.value="");this.temp.mainImgLocal=URL.createObjectURL(t.currentTarget.files[0])},minorImgUrlUpload(t){if(""===t.currentTarget.value||!t.currentTarget.value.includes("http"))return void alert("網址不得為空，或網址輸入錯誤");if(this.temp.minorImgUrls.length+this.temp.minorImgLocals.length>=5){alert("次要圖片上傳總張數為5張（含網址上傳及檔案上傳）"),this.temp.minorImgUrls.pop();const t=document.getElementsByClassName("minorInputUrl");return void(t[t.length-1].value="")}this.temp.minorImgUrls.push(t.currentTarget.value);const e=this.$refs.minorInputUrl.cloneNode(!0);e.children[0].value="",e.children[0].addEventListener("change",this.minorImgUrlUpload),this.$refs.minorInputs.insertBefore(e,this.$refs.minoreInputLocal)},createMinorImgUrl(t){if(t.currentTarget.files.length>5||t.currentTarget.files.length>5-this.temp.minorImgUrls.length)return alert("次要圖片上傳總張數為5張（含網址上傳及檔案上傳）"),void(t.currentTarget.value="");for(const e of t.currentTarget.files){const t=URL.createObjectURL(e);this.temp.minorImgLocals.push(t);const l={};l.file=e,l.url=t,this.temp.minorFileList.push(l)}t.currentTarget.value=""},removeUpload(t){if("url"===t.currentTarget.dataset.fun)this.temp.mainImgUrl="",this.temp.mainImgLocal="",this.$refs.inputMain.value="";else if("urls"===t.currentTarget.dataset.fun){let e="",l="";switch(t.target.nodeName){case"BUTTON":if(""===t.target.previousSibling.value)return;e=this.temp.minorImgUrls.indexOf(t.target.previousSibling.value),this.temp.minorImgUrls.splice(e,1),t.target.parentNode.remove();break;case"I":if(l=t.target.previousSibling.getAttribute("src"),this.temp.minorImgUrls.indexOf(l)>=0){e=this.temp.minorImgUrls.indexOf(l),this.temp.minorImgUrls.splice(e,1);const t=document.querySelectorAll(".minorInputUrl");for(const e of t)if(e.value===l){e.parentNode.remove();break}}else e=this.temp.minorImgLocals.indexOf(l),this.temp.minorImgLocals.splice(e,1),this.temp.minorFileList.forEach(((t,e,i)=>{t.url===l&&i.splice(e,1)}));break}}},uploadAllImg(){this.imgUploading=!0;const t="https://vue3-course-api.hexschool.io/api/lyt-api/admin/upload",e=[];if(this.temp.mainImgLocal){const l=new FormData,i=this.$refs.inputMain.files[0];l.append("file-to-upload",i),e.push(this.$http.post(t,l))}else this.product.imageUrl=this.temp.mainImgUrl,this.temp.mainImgUrl="";if(this.temp.minorImgLocals.length>0){const l=[];this.temp.minorFileList.forEach((e=>{const i=new FormData;i.append("files-to-upload",e.file),l.push(this.$http.post(t,i))}));const i=Promise.all(l);e.push(i)}else{this.product.imagesUrl=[...this.temp.minorImgUrls],this.temp.minorImgUrls=[];const t=document.querySelectorAll(".minorInputUrl");t.forEach((t=>{""!==t.value&&t.parentNode.remove()})),this.imgUploading=!1}Promise.all(e).then((t=>{for(const e of t)if(Array.isArray(e)){this.product.imagesUrl=[],this.temp.minorImgUrls.length>0&&(this.product.imagesUrl=[...this.temp.minorImgUrls]),e.forEach((t=>{this.product.imagesUrl.push(t.data.imageUrl)})),this.temp.minorImgLocals.forEach((t=>URL.revokeObjectURL(t))),this.temp.minorImgLocals=[],this.temp.minorImgUrls=[];const t=document.getElementsByClassName("minorInputUrl");for(let e=0;e<=t.length-2;e++)t[e].parentNode.remove();this.temp.minorFileList=""}else this.product.imageUrl=e.data.imageUrl,URL.revokeObjectURL(this.temp.mainImgLocal),this.temp.mainImgLocal="",this.temp.minorFileList={};this.imgUploading=!1})).catch((t=>{console.log(t),this.imgUploading=!1}))},emit(){if(this.product.price<0||this.product.origin_price<0)return void alert("價錢不得為負數");const t={...this.product};this.$emit("update-product",t),this.dismiss()}},mounted(){const t=document.querySelectorAll('[data-bs-toggle="tooltip"]'),e=[...t].map((t=>new(ht())(t)));e.forEach((t=>t.enable()))}},ft=l(89);const _t=(0,ft.Z)(bt,[["render",pt]]);var Ut=_t,vt=l(8660),It={inject:["emitter"],emits:["loading"],data(){return{products:[],pagination:{},tempProduct:{},isNew:!1}},components:{UpdateProductModal:Ut,DeleteModal:vt.Z},methods:{getProducts(t=1){this.$emit("loading",!0);const e=`https://vue3-course-api.hexschool.io/api/lyt-api/admin/products?page=${t}`;this.$http.get(e).then((t=>{const{products:e,pagination:l}=t.data;this.products=e,this.pagination=l;const i={...t.data,event:"取得產品列表"};this.emitter.emit("toastMsg",i),this.$emit("loading",!1)})).catch((t=>console.log(t)))},update(t){this.$emit("loading",!0);let e="";const l={data:{...t}};let i="";this.isNew?(i="post",e="https://vue3-course-api.hexschool.io/api/lyt-api/admin/product"):(i="put",e=`https://vue3-course-api.hexschool.io/api/lyt-api/admin/product/${t.id}`),this.$http({method:i,url:e,data:l}).then((t=>{const e={...t.data,event:"新增／更新產品資料"};this.emitter.emit("toastMsg",e),this.getProducts()})).catch((t=>console.log(t)))},erase(t){this.$emit("loading",!0);const e=`https://vue3-course-api.hexschool.io/api/lyt-api/admin/product/${t.id}`;this.$http.delete(e).then((t=>{const e={...t.data,event:"刪除產品資料"};this.emitter.emit("toastMsg",e),this.getProducts()})).catch((t=>console.log(t)))},adjustProduct(t,e){"編輯"===e.currentTarget.textContent.trim()?this.isNew=!1:this.isNew=!0,this.tempProduct=t,this.$refs.updateProductModal.showModal()},deleteProduct(t){this.tempProduct=t,this.$refs.deleteModal.showModal()}},created(){this.getProducts()}};const yt=(0,ft.Z)(It,[["render",f]]);var wt=yt}}]);
//# sourceMappingURL=792.57194c3d.js.map